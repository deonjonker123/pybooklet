{% extends "base.html" %}

{% block title %}{{ author_name }} - Booklet{% endblock %}

{% block content %}
<div class="page-container">
    <div class="page-header">
        <h1>‚úçÔ∏è {{ author_name }}</h1>
    </div>

    <!-- Search and Sort -->
    <div class="controls-bar">
        <div class="sort-box">
            <label for="sortBy">Sort by:</label>
            <select name="sort_by" id="sortBy" onchange="window.location.href='/author/{{ author_name }}?sort_by=' + this.value + '&page=1&limit={{ limit }}'">
                <option value="date_added" {% if sort_by == 'date_added' %}selected{% endif %}>Date Added</option>
                <option value="title" {% if sort_by == 'title' %}selected{% endif %}>Title</option>
                <option value="page_count" {% if sort_by == 'page_count' %}selected{% endif %}>Page Count</option>
            </select>
        </div>
        <div class="results-count">
            <span>{{ total_count }} books</span>
        </div>
    </div>

    <!-- Books Table -->
    <div class="table-container">
        <table class="books-table">
            <thead>
                <tr>
                    <th>Cover</th>
                    <th>Title</th>
                    <th>Series</th>
                    <th>Genre</th>
                    <th>Pages</th>
                    <th>Status</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody>
                {% for book in books %}
                <tr>
                    <td class="cover-cell">
                        {% if book.cover_url %}
                        <img src="{{ book.cover_url }}" alt="{{ book.title }}" class="table-cover">
                        {% else %}
                        <div class="table-cover-placeholder">üìï</div>
                        {% endif %}
                    </td>
                    <td><a href="/book/{{ book.id }}" class="book-link">{{ book.title }}</a></td>
                    <td>
                        {% if book.series %}
                        <a href="/series/{{ book.series }}" class="series-link">{{ book.series }} #{{ book.series_number }}</a>
                        {% else %}
                        -
                        {% endif %}
                    </td>
                    <td>
                        {% if book.genre %}
                        <a href="/genre/{{ book.genre }}" class="genre-link">{{ book.genre }}</a>
                        {% else %}
                        -
                        {% endif %}
                    </td>
                    <td>{{ book.page_count }}</td>
                    <td>
                        {% if book.status == 'library' %}
                        <span class="status-badge badge-library">Library</span>
                        {% elif book.status == 'tracking' %}
                        <span class="status-badge badge-tracking">Tracking</span>
                        {% elif book.status == 'completed' %}
                        <span class="status-badge badge-completed">Completed</span>
                        {% elif book.status == 'abandoned' %}
                        <span class="status-badge badge-abandoned">Abandoned</span>
                        {% endif %}
                    </td>
                    <td class="actions-cell">
                        <a href="/book/{{ book.id }}" class="btn-icon" title="Open">üëÅÔ∏è</a>
                        {% if book.status == 'library' %}
                        <form method="post" action="/library/read/{{ book.id }}" style="display: inline;" onsubmit="return confirm('Start reading this book?')">
                            <button type="submit" class="btn-icon" title="Read">üìñ</button>
                        </form>
                        <form method="post" action="/library/delete/{{ book.id }}" style="display: inline;" onsubmit="return confirm('Delete this book permanently?')">
                            <button type="submit" class="btn-icon btn-danger" title="Delete">üóëÔ∏è</button>
                        </form>
                        {% endif %}
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>

    <!-- Pagination -->
    {% if total_pages > 1 %}
    <div class="pagination">
        <div class="pagination-info">
            Page {{ current_page }} of {{ total_pages }}
        </div>
        <div class="pagination-controls">
            {% if current_page > 1 %}
            <a href="/author/{{ author_name }}?page={{ current_page - 1 }}&limit={{ limit }}&sort_by={{ sort_by }}" class="btn btn-secondary">Previous</a>
            {% endif %}

            {% if current_page < total_pages %}
            <a href="/author/{{ author_name }}?page={{ current_page + 1 }}&limit={{ limit }}&sort_by={{ sort_by }}" class="btn btn-secondary">Next</a>
            {% endif %}
        </div>
        <div class="pagination-limit">
            <label>Show:</label>
            <select onchange="window.location.href='/author/{{ author_name }}?page=1&limit=' + this.value + '&sort_by={{ sort_by }}'">
                <option value="50" {% if limit == 50 %}selected{% endif %}>50</option>
                <option value="100" {% if limit == 100 %}selected{% endif %}>100</option>
                <option value="200" {% if limit == 200 %}selected{% endif %}>200</option>
            </select>
        </div>
    </div>
    {% endif %}
</div>
{% endblock %}