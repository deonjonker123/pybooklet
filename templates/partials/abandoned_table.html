{% for book in books %}
<tr>
    <td class="cover-cell">
        {% if book.cover_url %}
        <img src="{{ book.cover_url }}" alt="{{ book.title }}" class="table-cover">
        {% else %}
        <div class="table-cover-placeholder">📕</div>
        {% endif %}
    </td>
 <td>
        <a href="/book/{{ book.id }}" class="book-link">{{ book.title }}</a>
        <br>
        <small>
            {% if book.series %}
            <a href="/series/{{ book.series }}" class="series-link">{{ book.series }} #{{ book.series_number }}</a>
            {% else %}
            -
            {% endif %}
        </small>
    </td>
    <td><a href="/author/{{ book.author }}" class="author-link">{{ book.author }}</a></td>
    <td>
        {% if book.genre %}
        <a href="/genre/{{ book.genre }}" class="genre-link">{{ book.genre }}</a>
        {% else %}
        -
        {% endif %}
    </td>
    <td>{{ book.page_count }}</td>
    <td>
        {% set abandon_percent = (book.page_at_abandonment / book.page_count * 100) | int %}
        {{ book.page_at_abandonment }} <span class="text-muted">({{ abandon_percent }}%)</span>
    </td>
    <td>{{ book.abandonment_date[:10] }}</td>
    <td class="actions-cell">
        <button class="btn-icon" onclick="openEditModal({{ book.id }}, {{ book.page_at_abandonment }}, '{{ (book.reason or '')|replace("'", "\\'") }}', '{{ book.start_date or '' }}', '{{ book.abandonment_date or '' }}')" title="Edit">✏️</button>
        <a href="/sessions/{{ book.id }}" class="btn-icon" title="Sessions">📊</a>
        <form method="post" action="/abandoned/remove/{{ book.id }}" style="display: inline;" onsubmit="return confirm('Remove from abandoned and return to library?')">
            <button type="submit" class="btn-icon btn-danger" title="Remove">🔙</button>
        </form>
    </td>
</tr>
{% endfor %}